const TelegramBot = require('node-telegram-bot-api');
const fs = require('fs');

// === –ù–ê–°–¢–†–û–ô–ö–ò ===
// –ü–æ–ª—É—á–∏ —Ç–æ–∫–µ–Ω —É @BotFather
const BOT_TOKEN = '–¢–í–û–ô_–¢–û–ö–ï–ù_–ë–û–¢–ê';
// –ü–æ–ª—É—á–∏ —Å–≤–æ–π ID —á–µ—Ä–µ–∑ @userinfobot
const ADMIN_ID = '–¢–í–û–ô_ID_–í_TELEGRAM';

// –°–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
const bot = new TelegramBot(BOT_TOKEN, { polling: true });

console.log('ü§ñ –ë–æ—Ç –∑–∞–ø—É—â–µ–Ω! –û–∂–∏–¥–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥...');

// === –ö–û–ú–ê–ù–î–´ –ë–û–¢–ê ===

// –ö–æ–º–∞–Ω–¥–∞ /start
bot.onText(/\/start/, (msg) => {
    const chatId = msg.chat.id;
    const userName = msg.from.first_name;
    
    bot.sendMessage(chatId, 
        `üëã –ü—Ä–∏–≤–µ—Ç, ${userName}!\n\n` +
        `–≠—Ç–æ –±–æ—Ç –º–∞–≥–∞–∑–∏–Ω–∞ "From Prompt To Result" üõí\n\n` +
        `üìö –ß—Ç–æ —É –Ω–∞—Å –µ—Å—Ç—å:\n` +
        `‚Ä¢ –®–∫–æ–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã - 349‚ÇΩ\n` +
        `‚Ä¢ –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã - 349‚ÇΩ\n` +
        `‚Ä¢ –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π - 449‚ÇΩ\n\n` +
        `üõí –î–ª—è –ø–æ–∫—É–ø–∫–∏ –∑–∞–π–¥–∏ –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω:\n` +
        `https://dxntxz.github.io/from-prompt-to-result/\n\n` +
        `‚ö° –ö–æ–º–∞–Ω–¥—ã:\n` +
        `/help - –ø–æ–º–æ—â—å\n` +
        `/buy - –∫—É–ø–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã\n` +
        `/support - –ø–æ–¥–¥–µ—Ä–∂–∫–∞`
    );
});

// –ö–æ–º–∞–Ω–¥–∞ /help
bot.onText(/\/help/, (msg) => {
    const chatId = msg.chat.id;
    
    bot.sendMessage(chatId,
        `‚ùì **–ö–∞–∫ –∫—É–ø–∏—Ç—å –ø—Ä–æ–º–ø—Ç—ã?**\n\n` +
        `1. –ó–∞–π–¥–∏ –≤ –Ω–∞—à –º–∞–≥–∞–∑–∏–Ω üëá\n` +
        `https://dxntxz.github.io/from-prompt-to-result/\n\n` +
        `2. –í—ã–±–µ—Ä–∏ –Ω—É–∂–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –∏ –¥–æ–±–∞–≤—å –≤ –∫–æ—Ä–∑–∏–Ω—É\n` +
        `3. –ü–µ—Ä–µ–π–¥–∏ –≤ –±–æ—Ç–∞ –¥–ª—è –æ–ø–ª–∞—Ç—ã\n\n` +
        `üí≥ **–°–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã:**\n` +
        `‚Ä¢ –°–ë–ü (–ø–æ –Ω–æ–º–µ—Ä—É —Ç–µ–ª–µ—Ñ–æ–Ω–∞)\n` +
        `‚Ä¢ –ÆMoney\n` +
        `‚Ä¢ –ö—Ä–∏–ø—Ç–æ (USDT)\n\n` +
        `üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞:** @toresfrpro`
    );
});

// –ö–æ–º–∞–Ω–¥–∞ /buy
bot.onText(/\/buy/, (msg) => {
    const chatId = msg.chat.id;
    
    const keyboard = {
        inline_keyboard: [
            [
                { text: 'üõí –û—Ç–∫—Ä—ã—Ç—å –º–∞–≥–∞–∑–∏–Ω', url: 'https://dxntxz.github.io/from-prompt-to-result/' }
            ],
            [
                { text: 'üí¨ –ü–æ–¥–¥–µ—Ä–∂–∫–∞', url: 'https://t.me/toresfrpro' }
            ]
        ]
    };
    
    bot.sendMessage(chatId,
        `üõí **–ü–æ–∫—É–ø–∫–∞ –ø—Ä–æ–º–ø—Ç–æ–≤**\n\n` +
        `1. –ü–µ—Ä–µ–π–¥–∏ –≤ –º–∞–≥–∞–∑–∏–Ω –ø–æ –∫–Ω–æ–ø–∫–µ –Ω–∏–∂–µ\n` +
        `2. –î–æ–±–∞–≤—å –Ω—É–∂–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã –≤ –∫–æ—Ä–∑–∏–Ω—É\n` +
        `3. –ü–æ—Å–ª–µ –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞ —è –ø—Ä–∏—à–ª—é —Ä–µ–∫–≤–∏–∑–∏—Ç—ã –¥–ª—è –æ–ø–ª–∞—Ç—ã\n\n` +
        `–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã –ø—Ä–∏—à–ª–∏ —Å–∫—Ä–∏–Ω—à–æ—Ç —á–µ–∫–∞ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è! ‚úÖ`,
        { reply_markup: keyboard }
    );
});

// –ö–æ–º–∞–Ω–¥–∞ /support
bot.onText(/\/support/, (msg) => {
    const chatId = msg.chat.id;
    
    bot.sendMessage(chatId,
        `üìû **–ü–æ–¥–¥–µ—Ä–∂–∫–∞**\n\n` +
        `–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –ø–æ–∫—É–ø–∫–∏, –æ–ø–ª–∞—Ç—ã –∏–ª–∏ –ø—Ä–æ–±–ª–µ–º —Å –¥–æ—Å—Ç—É–ø–æ–º:\n\n` +
        `‚Ä¢ –ö–∞–Ω–∞–ª: @toresfrpro\n` +
        `‚Ä¢ –õ–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –≤–ª–∞–¥–µ–ª—å—Ü—É\n\n` +
        `–û–±—ã—á–Ω–æ –æ—Ç–≤–µ—á–∞–µ–º –≤ —Ç–µ—á–µ–Ω–∏–µ 1-2 —á–∞—Å–æ–≤ –≤ —Ä–∞–±–æ—á–µ–µ –≤—Ä–µ–º—è.`
    );
});

// === –ê–î–ú–ò–ù-–ö–û–ú–ê–ù–î–´ ===

// –ö–æ–º–∞–Ω–¥–∞ /admin (—Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∞)
bot.onText(/\/admin/, (msg) => {
    const chatId = msg.chat.id;
    
    if (chatId.toString() !== ADMIN_ID) {
        bot.sendMessage(chatId, '‚ùå –≠—Ç–∞ –∫–æ–º–∞–Ω–¥–∞ —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞!');
        return;
    }
    
    const adminKeyboard = {
        keyboard: [
            ['üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞', 'üìã –ó–∞–∫–∞–∑—ã'],
            ['‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É', 'üì§ –í—ã–¥–∞—Ç—å —Ñ–∞–π–ª—ã'],
            ['üì¢ –†–∞—Å—Å—ã–ª–∫–∞', 'üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∏']
        ],
        resize_keyboard: true,
        one_time_keyboard: false
    };
    
    bot.sendMessage(chatId,
        `üëë **–ü–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞**\n\n` +
        `–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–π—Å—Ç–≤–∏–µ:`,
        { reply_markup: adminKeyboard }
    );
});

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–Ω–æ–ø–æ–∫ –∞–¥–º–∏–Ω–∞
bot.on('message', (msg) => {
    const chatId = msg.chat.id;
    const text = msg.text;
    
    if (chatId.toString() !== ADMIN_ID) return;
    
    if (text === 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞') {
        // –ó–¥–µ—Å—å –±—É–¥–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
        bot.sendMessage(chatId, 'üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:\n\n–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π: 0\n–ó–∞–∫–∞–∑–æ–≤: 0\n–ü—Ä–æ–¥–∞–∂: 0‚ÇΩ');
    }
    
    if (text === 'üìã –ó–∞–∫–∞–∑—ã') {
        bot.sendMessage(chatId, 'üìã –°–ø–∏—Å–æ–∫ –∑–∞–∫–∞–∑–æ–≤:\n\n–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç');
    }
    
    if (text === '‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –æ–ø–ª–∞—Ç—É') {
        bot.sendMessage(chatId,
            '‚úÖ **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –æ–ø–ª–∞—Ç—ã**\n\n' +
            '–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –ø—Ä–∏—à–ª–∏—Ç–µ:\n' +
            '1. ID –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è\n' +
            '2. –ù–æ–º–µ—Ä –∑–∞–∫–∞–∑–∞\n' +
            '3. –°—É–º–º—É –æ–ø–ª–∞—Ç—ã\n\n' +
            '–§–æ—Ä–º–∞—Ç: /confirm 123456789 order_001 349'
        );
    }
});

// –ö–æ–º–∞–Ω–¥–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã /confirm
bot.onText(/\/confirm (.+)/, (msg, match) => {
    const chatId = msg.chat.id;
    
    if (chatId.toString() !== ADMIN_ID) return;
    
    const params = match[1].split(' ');
    if (params.length < 3) {
        bot.sendMessage(chatId, '‚ùå –§–æ—Ä–º–∞—Ç: /confirm userId orderId amount');
        return;
    }
    
    const userId = params[0];
    const orderId = params[1];
    const amount = params[2];
    
    // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é —Å–æ–æ–±—â–µ–Ω–∏–µ –æ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏
    bot.sendMessage(userId,
        `‚úÖ **–û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞!**\n\n` +
        `–ó–∞–∫–∞–∑: ${orderId}\n` +
        `–°—É–º–º–∞: ${amount}‚ÇΩ\n\n` +
        `üì• –í–∞—à–∏ –ø—Ä–æ–º–ø—Ç—ã –¥–æ—Å—Ç—É–ø–Ω—ã –ø–æ —Å—Å—ã–ª–∫–∞–º:\n` +
        `1. –®–∫–æ–ª—å–Ω—ã–µ –ø—Ä–æ–º–ø—Ç—ã: https://dxntxz.github.io/from-prompt-to-result/school-prompts.html\n` +
        `2. –°—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏–µ –ø—Ä–æ–º–ø—Ç—ã: https://dxntxz.github.io/from-prompt-to-result/student-prompts.html\n` +
        `3. –ü—Ä–æ–º–ø—Ç—ã –¥–ª—è –ø—Ä–µ–∑–µ–Ω—Ç–∞—Ü–∏–π: https://dxntxz.github.io/from-prompt-to-result/presentation-prompts.html\n\n` +
        `üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–∏ —Å—Å—ã–ª–∫–∏!`
    );
    
    bot.sendMessage(chatId,
        `‚úÖ –û–ø–ª–∞—Ç–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${userId}\n` +
        `–ó–∞–∫–∞–∑: ${orderId}\n` +
        `–°—É–º–º–∞: ${amount}‚ÇΩ`
    );
});

// === –û–ë–†–ê–ë–û–¢–ö–ê –°–ö–†–ò–ù–®–û–¢–û–í –û–ü–õ–ê–¢–´ ===
bot.on('photo', (msg) => {
    const chatId = msg.chat.id;
    
    // –ü–µ—Ä–µ—Å—ã–ª–∞–µ–º –∞–¥–º–∏–Ω—É —Å–∫—Ä–∏–Ω—à–æ—Ç
    bot.forwardMessage(ADMIN_ID, chatId, msg.message_id);
    
    bot.sendMessage(ADMIN_ID,
        `üì∏ –ü–æ–ª—É—á–µ–Ω —Å–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è ${chatId}\n\n` +
        `–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –æ–ø–ª–∞—Ç—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ:\n` +
        `/confirm ${chatId} order_XXX —Å—É–º–º–∞`
    );
    
    bot.sendMessage(chatId,
        `üì∏ –°–∫—Ä–∏–Ω—à–æ—Ç –æ–ø–ª–∞—Ç—ã –ø–æ–ª—É—á–µ–Ω!\n\n` +
        `–ú—ã –ø—Ä–æ–≤–µ—Ä–∏–º –æ–ø–ª–∞—Ç—É –∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 1 —á–∞—Å–∞ –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–º –µ—ë.\n` +
        `–ü–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã –ø–æ–ª—É—á–∏—Ç–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–∞–π–ª—ã —Å –ø—Ä–æ–º–ø—Ç–∞–º–∏.`
    );
});

// === –û–ë–†–ê–ë–û–¢–ö–ê –û–®–ò–ë–û–ö ===
bot.on('polling_error', (error) => {
    console.error('–û—à–∏–±–∫–∞ –±–æ—Ç–∞:', error);
});

console.log('‚úÖ –ë–æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ –≥–æ—Ç–æ–≤ –∫ —Ä–∞–±–æ—Ç–µ!');
console.log('üëë –ê–¥–º–∏–Ω ID:', ADMIN_ID);